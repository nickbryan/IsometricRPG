!function(){if(!window.requestAnimationFrame||!window.cancelAnimationFrame){for(var a=0,b=["ms","moz","webkit","o"],c=0;c<b.length&&!window.requestAnimationFrame;++c)window.requestAnimationFrame=window[b[c]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[b[c]+"CancelAnimationFrame"]||window[b[c]+"CancelRequestAnimationFrame"];!window.requestAnimationFrame&&window.setTimeout&&(window.requestAnimationFrame=function(b){var c=Date.now(),d=Math.max(0,16-(c-a)),e=window.setTimeout(function(){b(c+d)},d);return a=c-d,e}),!window.cancelAnimationFrame&&window.clearTimeout&&(window.cancelAnimationFrame=function(a){window.clearTimeout(a)})}}(),function(){if(window.performance||(window.performance={}),!window.performance.now){var a=Date.now();window.performance.now=function(){return Date.now()-a}}}(),function(){window.GameEngine=window.GameEngine||{},GameEngine.VERSION="0.1.0"}(),function(){GameEngine.Helpers=function(){return{extend:function(a,b,c,d){c=c||!1,d=d||!1;var e=[];e=d?Object.keys(b):this.getAllKeys(b);for(var f=0;f<e.length;f++){var g=e[f];c?a[g]=b[g]:"undefined"==typeof a[g]&&(a[g]=b[g])}return a},getAllKeys:function(a){if(!this.isObject(a))return[];var b=[];for(var c in a)b.push(c);return b},isFunction:function(a){var b=typeof a;return"function"===b&&!!a},isObject:function(a){var b=typeof a;return"function"===b||"object"===b&&!!a},isTrueObject:function(a){var b=typeof a;return"object"===b&&!!a}}}()}(),function(){GameEngine.Math=function(){return{clamp:function(a,b,c){return Math.max(b,Math.min(c,a))}}}()}(),function(){GameEngine.Math.Vector2D=function(a,b){this.x=0,this.y=0,this.set(a||0,b||0)},GameEngine.Helpers.extend(GameEngine.Math.Vector2D.prototype,{set:function(a,b){if(isNaN(a))throw new Error("Invalid x parameter for vector ["+a+"]");if(isNaN(b))throw new Error("Invalid y parameter for vector ["+b+"]");return this.x=a,this.y=b,this},add:function(a){if(!(a instanceof GameEngine.Math.Vector2D))throw new Error("Parameter must be an instance of GameEngine.Math.Vector2D.");return new GameEngine.Vector2D(this.x+a.x,this.y+a.y)},addTo:function(a){if(!(a instanceof GameEngine.Math.Vector2D))throw new Error("Parameter must be an instance of GameEngine.Math.Vector2D.");return this.x+=a.x,this.y+=a.y,this},subtract:function(a){if(!(a instanceof GameEngine.Math.Vector2D))throw new Error("Parameter must be an instance of GameEngine.Math.Vector2D.");return new GameEngine.Vector2D(this.x-a.x,this.y-a.y)},subtractFrom:function(a){if(!(a instanceof GameEngine.Math.Vector2D))throw new Error("Parameter must be an instance of GameEngine.Math.Vector2D.");return this.x-=a.x,this.y-=a.y,this},multiplyScalar:function(a){return new GameEngine.Vector2D(this.x*a,this.y*a)},multiplyByScalar:function(a){return this.x*=a,this.y*=a,this},divideScalar:function(a){return new GameEngine.Vector2D(this.x/a,this.y/a)},divideByScalar:function(a){return this.x/=a,this.y/=a,this},invertX:function(){return this.x*=-1,this},invertY:function(){return this.y*=-1,this},invert:function(){return this.invertX(),this.invertY(),this},copy:function(a){if(!(a instanceof GameEngine.Math.Vector2D))throw new Error("Parameter must be an instance of GameEngine.Math.Vector2D.");return this.set(a.x,a.y)},makePerpendicular:function(){return this.set(this.y,-this.x)},zero:function(){return this.set(0,0)},lengthSquare:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.lengthSquare())},normalise:function(){var a=this.length();return 0===a?(this.x=1,this.y=0,this):this.divideByScalar(a)},floorSelf:function(){return this.set(Math.floor(this.x),Math.floor(this.y))},ceilSelf:function(){return this.set(Math.ceil(this.x),Math.ceil(this.y))}},!0),GameEngine.Math.Vector2D.prototype.magnitude=GameEngine.Math.Vector2D.prototype.length}(),function(){GameEngine.Math.Matrix2D=function(){this.matrix=new Float32Array(9),this.identity()},GameEngine.Helpers.extend(GameEngine.Math.Matrix2D.prototype,{identity:function(){return this.set(1,0,0,0,1,0,0,0,1),this},set:function(){if(9!==arguments.length)throw new Error("Invalid number of arguments for matrix.");for(var a=0;a<arguments.length;a++)this.matrix[a]=arguments[a];return this},translate:function(a,b){return this.matrix[6]+=a*this.matrix[0]+b*this.matrix[3],this.matrix[7]+=a*this.matrix[1]+b*this.matrix[4],this},isIdentity:function(){return 1===this.matrix[0]&&0===this.matrix[1]&&0===this.matrix[2]&&0===this.matrix[3]&&1===this.matrix[4]&&0===this.matrix[5]&&0===this.matrix[6]&&0===this.matrix[7]&&1===this.matrix[8]}},!0)}(),function(){GameEngine.Renderer=function(a,b,c){return this.scaleRatio=new GameEngine.Math.Vector2D,this.canvas=this.createCanvas(a,b),this.wrapper=document.getElementById("game-screen"),this.wrapper.appendChild(this.canvas),this.context=this.canvas.getContext("2d"),this.scaleRatio.set(this.canvas.width/this.canvas.offsetWidth,this.canvas.height/this.canvas.offsetHeight),this.doubleBufferingEnabled=c||!1,this.doubleBufferingEnabled?(this.backBuffer=this.createCanvas(a,b),this.backBufferContext=this.backBuffer.getContext("2d")):(this.backBuffer=this.canvas,this.backBufferContext=this.context),this},GameEngine.Helpers.extend(GameEngine.Renderer.prototype,{createCanvas:function(a,b){if(0===a||0===b)throw Error("Width and height need to be greater than zero for canvas creation.");var c=document.createElement("canvas");c.width=a||this.canvas.width,c.height=b||this.canvas.height;var d=window.innerWidth/a,e=window.innerHeight/b,f=window.innerWidth/window.innerHeight,g=Math.min(d,e);return f>=1.77&&1.79>=f?(c.style.width=window.innerWidth+"px",c.style.height=window.innerHeight+"px"):(c.style.width=a*g+"px",c.style.height=b*g+"px"),c},getContext:function(){return this.backBufferContext},clearScreen:function(a){return this.backBufferContext.save(),this.backBufferContext.setTransform(1,0,0,1,0,0),this.backBufferContext.fillStyle=a||"black",this.backBufferContext.fillRect(0,0,this.canvas.width,this.canvas.height),this.backBufferContext.restore(),this},drawFrontBuffer:function(){return this.context.drawImage(this.backBuffer,0,0),this}},!0)}(),function(){GameEngine.Event=function(){var a={};return{KEY_UP:"GameEngine.input.keyup",KEY_DOWN:"GameEngine.input.keydown",publish:function(b,c){for(var d=a[b],e=d?d.length:0;e--;)d[e].apply(window,c||[])},subscribe:function(b,c){return a[b]||(a[b]=[]),a[b].push(c),{topic:b,callback:c}},unsubscribe:function(b){for(var c=a[b.topic],d=b.callback,e=c?c.length:0;e--;)c[e]===d&&c.splice(e,1)}}}()}(),function(){GameEngine.Loader=function(){function a(a,b,d){c[a.name]=new Image,c[a.name].onload=b,c[a.name].onerror=d,c[a.name].src=a.src}function b(a,b,c){var e=new XMLHttpRequest;e.overrideMimeType&&e.overrideMimeType("application/json"),e.open("GET",a.src,!0),e.ontimeout=c,e.onreadystatechange=function(){4===e.readyState&&(200===e.status||0===e.status&&e.responseText?(d[a.name]=JSON.parse(e.responseText),b()):c())},e.send(null)}var c={},d={};return{loadResource:function(c,d,e){switch(c.type){case"json":return b(c,d,e),!0;case"image":return a(c,d,e),!0;default:throw new Error("Unknown resource type "+c.type+".")}},getJSONResource:function(a){return a=""+a,a in d?d[a]:null},getImage:function(a){return a=""+a,a in c?c[a]:null}}}()}(),function(){var a={BACKSPACE:8,TAB:9,ENTER:13,SHIFT:16,CTRL:17,ALT:18,PAUSE:19,CAPS_LOCK:20,ESC:27,SPACE:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,PRINT_SCREEN:42,INSERT:45,DELETE:46,NUM0:48,NUM1:49,NUM2:50,NUM3:51,NUM4:52,NUM5:53,NUM6:54,NUM7:55,NUM8:56,NUM9:57,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,WINDOW_KEY:91,NUMPAD0:96,NUMPAD1:97,NUMPAD2:98,NUMPAD3:99,NUMPAD4:100,NUMPAD5:101,NUMPAD6:102,NUMPAD7:103,NUMPAD8:104,NUMPAD9:105,MULTIPLY:106,ADD:107,SUBSTRACT:109,DECIMAL:110,DIVIDE:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,NUM_LOCK:144,SCROLL_LOCK:145,SEMICOLON:186,PLUS:187,COMMA:188,MINUS:189,PERIOD:190,FORWAND_SLASH:191,GRAVE_ACCENT:192,OPEN_BRACKET:219,BACK_SLASH:220,CLOSE_BRACKET:221,SINGLE_QUOTE:222};GameEngine.Input=function(){this.KEYS=a,this.boundKeys={},this.keyPressed={},this.preventDefaultForBoundKeys={},this.preventDefault=!0,window.addEventListener("keydown",this.keyDownCallback.bind(this),!1),window.addEventListener("keyup",this.keyUpCallback.bind(this),!1)},GameEngine.Helpers.extend(GameEngine.Input.prototype,{bindKeyAction:function(a,b,c){"boolean"!=typeof c&&(c=this.preventDefault),this.boundKeys[a]=b,this.preventDefaultForBoundKeys[a]=c,this.keyPressed[b]=!1},keyDownCallback:function(a){var b=a.keyCode||a.which,c=this.boundKeys[b];return GameEngine.Event.publish(GameEngine.Event.KEY_DOWN,[c,b]),c&&(this.keyPressed[c]=!0,this.preventDefaultForBoundKeys[b])?this.preventDefaultAction(a):!0},keyUpCallback:function(a){var b=a.keyCode||a.which,c=this.boundKeys[b];return GameEngine.Event.publish(GameEngine.Event.KEY_UP,[c,b]),c&&(this.keyPressed[c]=!1,this.preventDefaultForBoundKeys[b])?this.preventDefaultAction(a):!0},isKeyPressed:function(a){return this.keyPressed[a]},preventDefaultAction:function(a){return a.stopPropagation?a.stopPropagation():a.cancelBubble=!0,a.preventDefault?a.preventDefault():a.returnValue=!1,!1}},!0)}(),function(){GameEngine.Shapes=GameEngine.Shapes||{}}(),function(){GameEngine.Shapes.Rectangle=function(a,b,c,d){return this.position=new GameEngine.Math.Vector2D(a,b),this._width=c,this._height=d,this.points=[new GameEngine.Math.Vector2D(0,0),new GameEngine.Math.Vector2D(Math.abs(c)==1/0?0:c,0),new GameEngine.Math.Vector2D(Math.abs(c)==1/0?0:c,Math.abs(d)==1/0?0:d),new GameEngine.Math.Vector2D(0,Math.abs(d)==1/0?0:d)],this.edges=[],this.normals=[],this.recalculate(),this},GameEngine.Helpers.extend(GameEngine.Shapes.Rectangle.prototype,{set:function(a,b,c,d){return this._width=c,this._height=d,this.points[0].set(0,0),this.points[0].set(c,0),this.points[0].set(c,d),this.points[0].set(0,d),this.recalculate(),this},resize:function(a,b){return this.width=a,this.height=b,this},recalculate:function(){var a=this.points.length;this.edges=[],this.normals=[];for(var b=0;a>b;b++){var c=new GameEngine.Math.Vector2D;c.copy(this.points[(b+1)%a]).subtractFrom(this.points[b]),this.edges.push(c);var d=new GameEngine.Math.Vector2D;d.copy(c).makePerpendicular().normalise(),this.normals.push(d)}return this},clone:function(){return new GameEngine.Shapes.Rectangle(this.position.x,this.position.y,this._width,this._height)},copy:function(a){if(!(a instanceof GameEngine.Shapes.Rectangle))throw new Error("Cannot copy value that is not an instance of GameEngine.Shapes.Rectangle.");return this.set(a.position.x,a.position.y,a.width,a.height)},translate:function(a,b){return this.position.x=a,this.position.y=b,this},translateVector:function(a){if(!(a instanceof GameEngine.Math.Vector2D))throw new Error("Parameter must be an instance of GameEngine.Math.Vector2D.");return this.position.x=a.x,this.position.y=a.y,this},mergeWith:function(a){if(!(a instanceof GameEngine.Shapes.Rectangle))throw new Error("Cannot merge with value that is not an instance of GameEngine.Shapes.Rectangle.");var b=Math.min(this.left,a.left),c=Math.min(this.top,a.top);return this.resize(Math.max(this.right,a.right)-b,Math.max(this.bottom,a.bottom)-c),this.position.set(b,c),this},intersects:function(a){if(!(a instanceof GameEngine.Shapes.Rectangle))throw new Error("Cannot check if rectangle intersects with value that is not an instance of GameEngine.Shapes.Rectangle.");return this.left<a.right&&a.left<this.right&&this.top<a.bottom&&a.top<this.bottom},contains:function(a){if(!(a instanceof GameEngine.Shapes.Rectangle))throw new Error("Cannot check value that is not an instance of GameEngine.Shapes.Rectangle.");return a.left>=this.left&&a.right<=this.right&&a.top>=this.top&&a.bottom<=this.bottom},containsPoint:function(a,b){return a>=this.left&&a<=this.right&&b>=this.top&&b<=this.bottom},containsPointV:function(a){if(!(a instanceof GameEngine.Math.Vector2D))throw new Error("Parameter must be an instance of GameEngine.Math.Vector2D.");return this.containsPoint(a.x,a.y)}},!0),Object.defineProperty(GameEngine.Shapes.Rectangle.prototype,"top",{get:function(){return this.position.y},configurable:!0}),Object.defineProperty(GameEngine.Shapes.Rectangle.prototype,"right",{get:function(){return this.position.x+this._width||this._width},configurable:!0}),Object.defineProperty(GameEngine.Shapes.Rectangle.prototype,"bottom",{get:function(){return this.position.y+this._height||this._height},configurable:!0}),Object.defineProperty(GameEngine.Shapes.Rectangle.prototype,"left",{get:function(){return this.position.x},configurable:!0}),Object.defineProperty(GameEngine.Shapes.Rectangle.prototype,"width",{get:function(){return this._width},set:function(a){this._width=a,this.points[1].x=this.points[2].x=a,this.recalculate()},configurable:!0}),Object.defineProperty(GameEngine.Shapes.Rectangle.prototype,"height",{get:function(){return this._height},set:function(a){this._height=a,this.points[2].y=this.points[3].y=a,this.recalculate()},configurable:!0})}(),function(){GameEngine.Renderable=function(a,b,c,d){return GameEngine.Shapes.Rectangle.call(this,a,b,c,d),this.GUID=null,this.inViewport=!1,this.container=null,this.worldPosition=new GameEngine.Math.Vector2D(a,b),this},GameEngine.Renderable.prototype=Object.create(GameEngine.Shapes.Rectangle.prototype),GameEngine.Helpers.extend(GameEngine.Renderable.prototype,{constructor:GameEngine.Renderable,update:function(a){},render:function(a){}},!0)}(),function(){GameEngine.Entity=function(a,b,c,d,e,f){return GameEngine.Renderable.call(this,c,d,e,f),this.game=a,this.name=b,this.alive=!0,this},GameEngine.Entity.prototype=Object.create(GameEngine.Renderable.prototype),GameEngine.Helpers.extend(GameEngine.Entity.prototype,{constructor:GameEngine.Entity,update:function(a){},render:function(a,b){a.fillStyle="white",a.fillRect(this.position.x,this.position.y,this.width,this.height)}},!0)}(),function(){GameEngine.Container=function(a,b,c,d){return GameEngine.Renderable.call(this,a,b,c,d),this.root=!1,this.name=null,this.children=[],this.transformationMatrix=new GameEngine.Math.Matrix2D,this},GameEngine.Container.prototype=Object.create(GameEngine.Renderable.prototype),GameEngine.Helpers.extend(GameEngine.Container.prototype,{constructor:GameEngine.Container,addChild:function(a){return null!==a.container,a.container=this,this.children.push(a),a},update:function(a){for(var b=0;b<this.children.length;b++){var c=this.children[b];c.update(a)}},render:function(a,b){var c=!1;this.transformationMatrix.isIdentity()?a.translate(this.position.x,this.position.y):(c=!0,a.save(),a.transform(this.transformationMatrix.matrix[0],this.transformationMatrix.matrix[1],this.transformationMatrix.matrix[3],this.transformationMatrix.matrix[4],this.transformationMatrix.matrix[6],this.transformationMatrix.matrix[7]));for(var d=0;d<this.children.length;d++){var e=this.children[d];e.render(a,b)}c?a.restore():a.translate(-this.position.x,-this.position.y)}},!0)}(),function(){GameEngine.ViewPort=function(a,b,c,d,e){return GameEngine.Renderable.call(this,b,c,d-b,e-c),this.game=a,this.deadZone=new GameEngine.Shapes.Rectangle(0,0,0,0),this.target=null,this.bounds=new GameEngine.Shapes.Rectangle(-(1/0),-(1/0),1/0,1/0),this.setDeadZone(this.width/6,this.height/6),this},GameEngine.ViewPort.prototype=Object.create(GameEngine.Renderable.prototype),GameEngine.Helpers.extend(GameEngine.ViewPort.prototype,{constructor:GameEngine.ViewPort,follow:function(a){if(!(a instanceof GameEngine.Entity))throw new Error("Follow target is not an instance of GameEngine.Entity");return this.target=a.position,this.updateTarget(),this},setDeadZone:function(a,b){return this.deadZone.translate(Math.floor((this.width-a)/2),Math.floor((this.height-b)/2-.25*b)),this.deadZone.resize(a,b),this},screenToWorldCoordinates:function(a,b){var c=new GameEngine.Math.Vector2D(a,b);return c.addTo(this.position).subtractFrom(this.game.world.position),c},update:function(a){this.updateTarget()},updateTarget:function(){null!==this.target&&(this.target.x-this.position.x>this.deadZone.right?this.position.x=Math.floor(Math.min(this.target.x-this.deadZone.right,this.bounds.width-this.width)):this.target.x-this.position.x<this.deadZone.position.x&&(this.position.x=Math.floor(Math.max(this.target.x-this.deadZone.position.x,this.bounds.position.x))),this.target.y-this.position.y>this.deadZone.bottom?this.position.y=Math.floor(Math.min(this.target.y-this.deadZone.bottom,this.bounds.height-this.height)):this.target.y-this.position.y<this.deadZone.position.y&&(this.position.y=Math.floor(Math.max(this.target.y-this.deadZone.position.y,this.bounds.position.y))))},worldToScreenCoordinates:function(a,b){var c=new GameEngine.Math.Vector2D(a,b);return c.subtractFrom(this.position).addTo(this.game.world.position),c}},!0)}(),function(){GameEngine.IsometricRenderer=function(a,b,c,d){this.columns=a,this.rows=b,this.tileWidth=c,this.tileHeight=d,this.hTileWidth=c/2,this.hTileHeight=d/2,this.originX=this.rows*this.hTileWidth},GameEngine.Helpers.extend(GameEngine.IsometricRenderer.prototype,{pixelToTileCoordinates:function(a,b,c){var d=c||new GameEngine.Math.Vector2D;return d.set(this.pixelToTileX(a,b),this.pixelToTileY(b,a))},pixelToTileX:function(a,b){return b/this.tileHeight+(a-this.originX)/this.tileWidth},pixelToTileY:function(a,b){return a/this.tileHeight-(b-this.originX)/this.tileWidth},tileToPixelCoordinates:function(a,b,c){var d=c||new GameEngine.Math.Vector2D;return d.set((a-b)*this.hTileWidth+this.originX,(a+b)*this.hTileHeight)},render:function(a,b,c){var d=b.tileSet,e=d.tileOffset,f=this.pixelToTileCoordinates(c.position.x-d.tileWidth,c.position.y-d.tileHeight).floorSelf(),g=this.pixelToTileCoordinates(c.position.x+c.width+d.tileWidth,c.position.y+c.height+d.tileHeight).ceilSelf(),h=this.tileToPixelCoordinates(g.x,g.y),i=this.tileToPixelCoordinates(f.x,f.y);i.x-=this.hTileWidth,i.y+=this.tileHeight;var j=i.y-c.position.y>this.hTileHeight,k=c.position.x-i.x<this.hTileWidth;j&&(k?(f.x--,i.x-=this.hTileWidth):(f.y--,i.x+=this.hTileWidth),i.y-=this.hTileHeight);for(var l=j&&!k||!j&&k,m=new GameEngine.Math.Vector2D(f.x,f.y),n=2*i.y;n-2*this.tileHeight<2*h.y;n+=this.tileHeight){m.set(f.x,f.y);for(var o=i.x;o<h.x;o+=this.tileWidth){if(m.x>=0&&m.y>=0&&m.x<this.columns&&m.y<this.rows){var p=b.layerData[m.x][m.y];p&&(d=p.tileSet,e=d.tileOffset,d.drawTile(a,e.x+o,e.y+n/2-d.tileHeight,p))}m.x++,m.y--}l?(f.y++,i.x-=this.hTileWidth,l=!1):(f.x++,i.x+=this.hTileWidth,l=!0)}}},!0)}(),function(){GameEngine.Tile=function(a,b,c,d){GameEngine.Shapes.Rectangle.call(this,a*d.tilewidth,b*d.tileheight,d.tilewidth,d.tileheight),this.tileSet=d,this.column=a,this.row=b,this.tileID=c},GameEngine.Tile.prototype=Object.create(GameEngine.Shapes.Rectangle.prototype),GameEngine.Helpers.extend(GameEngine.Tile.prototype,{constructor:GameEngine.Tile},!0)}(),function(){GameEngine.Layer=function(a,b,c,d){GameEngine.Renderable.call(this,0,0,0,0),this.name=a.name,this.columns=a.width,this.rows=a.height,this.tileWidth=b,this.tileHeight=c,this.tileSets=d,this.width=(this.columns+this.rows)*(this.tileWidth/2),this.height=(this.columns+this.rows)*(this.tileHeight/2),this.tileSet=this.tileSets[0],this.layerData=[];for(var e=0;e<this.columns;e++){this.layerData[e]=[];for(var f=0;f<this.rows;f++)this.layerData[e][f]=null}this.maxTileSize={width:0,height:0};for(var g=0;g<this.tileSets.length;g++){var h=this.tileSets[g];this.maxTileSize.width=Math.max(this.maxTileSize.width,h.tileWidth),this.maxTileSize.height=Math.max(this.maxTileSize.height,h.tileHeight)}this.renderer=new GameEngine.IsometricRenderer(this.columns,this.rows,this.tileWidth,this.tileHeight),this.setLayerData(a.data)},GameEngine.Layer.prototype=Object.create(GameEngine.Renderable.prototype),GameEngine.Helpers.extend(GameEngine.Layer.prototype,{constructor:GameEngine.Layer,setLayerData:function(a){for(var b=0,c=0;c<this.rows;c++)for(var d=0;d<this.columns;d++){var e=a[b++];0!==e&&(this.layerData[d][c]=new GameEngine.Tile(d,c,e,this.tileSet))}},render:function(a,b){this.renderer.render(a,this,b)}},!0)}(),function(){GameEngine.TileSet=function(a){this.name=a.name,this.tileWidth=a.tilewidth,this.tileHeight=a.tileheight,this.spacing=a.spacing||0,this.margin=a.margin||0,this.tileOffset=new GameEngine.Math.Vector2D;var b=a.tileoffset;if(b&&(this.tileOffset.x=b.x,this.tileOffset.y=b.y),this.image=GameEngine.Loader.getImage(a.image),null===this.image)throw Error(a.image+" cannot be found.");this.horizontalTileCount=a.columns||Math.floor(this.image.width/(this.tileWidth+this.spacing)),this.verticalTileCount=Math.floor(this.image.height/(this.tileHeight+this.spacing)),this.firstGID=a.firstgid,this.lastGID=this.firstGID+(this.horizontalTileCount*this.verticalTileCount-1||0),a.tilecount&&this.lastGID-this.firstGID+1!==+a.tilecount&&console.warn("Computed tilecount ("+(this.lastGID-this.firstGID+1)+") does not match expected tilecount ("+a.tilecount+")")},GameEngine.Helpers.extend(GameEngine.TileSet.prototype,{drawTile:function(a,b,c,d){a.drawImage(this.image,this.tileOffset.x,this.tileOffset.y,this.tileWidth,this.tileHeight,b,c,this.tileWidth,this.tileHeight)}},!0)}(),function(){GameEngine.Map=function(a,b){this.name=a,this.data=b,this.columns=b.width,this.rows=b.height,this.tileWidth=b.tilewidth,this.tileHeight=b.tileheight,this.tileSets=[],this.layers=[],this.width=(this.columns+this.rows)*(this.tileWidth/2),this.height=(this.columns+this.rows)*(this.tileHeight/2),this.zIndex=0,this.load()},GameEngine.Helpers.extend(GameEngine.Map.prototype,{load:function(){for(var a=0;a<this.data.tilesets.length;a++){var b=this.data.tilesets[a];this.tileSets.push(new GameEngine.TileSet(b))}for(var c=0;c<this.data.layers.length;c++){var d=this.data.layers[c];switch(d.type){case"tilelayer":this.layers.push(new GameEngine.Layer(d,this.tileWidth,this.tileHeight,this.tileSets));break;default:throw Error(d.type+" has not been implemented as a layer type yet.")}}},addTo:function(a){for(var b=0;b<this.layers.length;b++){var c=this.layers[b];a.addChild(c)}}},!0)}(),function(){GameEngine.Game=function(a,b){this.animationFrameId=-1,this.input=new GameEngine.Input,this.renderer=new GameEngine.Renderer(a,b),this.viewport=new GameEngine.ViewPort(this,0,0,a,b),this.world=new GameEngine.Container(0,0,a,b),this.world.name="gameWorldContainer",this.world.root=!0},GameEngine.Helpers.extend(GameEngine.Game.prototype,{gameLoop:function(a){return this.update(a),this.render(),-1!==this.animationFrameId&&(this.animationFrameId=window.requestAnimationFrame(this.gameLoop.bind(this))),this},render:function(){return this.renderer.clearScreen("#0d3349"),this.world.transformationMatrix.translate(-this.viewport.position.x,-this.viewport.position.y),this.world.render(this.renderer.getContext(),this.viewport),this.renderer.drawFrontBuffer(),this.world.transformationMatrix.translate(this.viewport.position.x,this.viewport.position.y),this},startGameLoop:function(){return-1===this.animationFrameId&&(this.animationFrameId=window.requestAnimationFrame(this.gameLoop.bind(this))),this},stopGameLoop:function(){return window.cancelAnimationFrame(this.animationFrameId),this.animationFrameId=-1,this},update:function(a){return this.world.update(a),this.viewport.update(a),this}},!0)}();
//# sourceMappingURL=engine.min.js.map